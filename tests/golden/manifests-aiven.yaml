apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  labels:
    aiven: enabled
  name: aiven-demo
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      aiven: enabled
      app: aiven-demo
  strategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        aiven: enabled
        app: aiven-demo
    spec:
      containers:
        - image: nginx:1.25
          name: aiven-demo
          env:
            - name: OPEN_SEARCH_USERNAME
              valueFrom:
                secretKeyRef:
                  key: OPEN_SEARCH_USERNAME
                  name: aiven-opensearch
            - name: OPEN_SEARCH_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: OPEN_SEARCH_PASSWORD
                  name: aiven-opensearch
            - name: OPEN_SEARCH_URI
              valueFrom:
                secretKeyRef:
                  key: OPEN_SEARCH_URI
                  name: aiven-opensearch
            - name: OPEN_SEARCH_HOST
              valueFrom:
                secretKeyRef:
                  key: OPEN_SEARCH_HOST
                  name: aiven-opensearch
                  optional: true
            - name: OPEN_SEARCH_PORT
              valueFrom:
                secretKeyRef:
                  key: OPEN_SEARCH_PORT
                  name: aiven-opensearch
                  optional: true
            - name: AIVEN_CA
              valueFrom:
                secretKeyRef:
                  key: AIVEN_CA
                  name: aiven-opensearch
                  optional: true
            - name: REDIS_USERNAME_NAISTEST1
              valueFrom:
                secretKeyRef:
                  key: REDIS_USERNAME_NAISTEST1
                  name: aiven-valkey-naistest1
            - name: REDIS_PASSWORD_NAISTEST1
              valueFrom:
                secretKeyRef:
                  key: REDIS_PASSWORD_NAISTEST1
                  name: aiven-valkey-naistest1
            - name: REDIS_URI_NAISTEST1
              valueFrom:
                secretKeyRef:
                  key: REDIS_URI_NAISTEST1
                  name: aiven-valkey-naistest1
            - name: REDIS_HOST_NAISTEST1
              valueFrom:
                secretKeyRef:
                  key: REDIS_HOST_NAISTEST1
                  name: aiven-valkey-naistest1
                  optional: true
            - name: REDIS_PORT_NAISTEST1
              valueFrom:
                secretKeyRef:
                  key: REDIS_PORT_NAISTEST1
                  name: aiven-valkey-naistest1
                  optional: true
            - name: VALKEY_USERNAME_NAISTEST1
              valueFrom:
                secretKeyRef:
                  key: VALKEY_USERNAME_NAISTEST1
                  name: aiven-valkey-naistest1
            - name: VALKEY_PASSWORD_NAISTEST1
              valueFrom:
                secretKeyRef:
                  key: VALKEY_PASSWORD_NAISTEST1
                  name: aiven-valkey-naistest1
            - name: VALKEY_URI_NAISTEST1
              valueFrom:
                secretKeyRef:
                  key: VALKEY_URI_NAISTEST1
                  name: aiven-valkey-naistest1
            - name: VALKEY_HOST_NAISTEST1
              valueFrom:
                secretKeyRef:
                  key: VALKEY_HOST_NAISTEST1
                  name: aiven-valkey-naistest1
                  optional: true
            - name: VALKEY_PORT_NAISTEST1
              valueFrom:
                secretKeyRef:
                  key: VALKEY_PORT_NAISTEST1
                  name: aiven-valkey-naistest1
                  optional: true
          ports:
            - containerPort: 8080
              name: http
---
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  labels:
    aiven: enabled
  name: aiven-demo
  namespace: default
spec:
  ports:
    - name: http
      port: 80
      targetPort: 8080
  selector:
    aiven: enabled
    app: aiven-demo
  type: ClusterIP
---
apiVersion: aiven.nais.io/v1
kind: AivenApplication
metadata:
  annotations: {}
  labels:
    aiven: enabled
  name: aiven-demo
  namespace: default
spec:
  openSearch:
    access: read
    instance: opensearch-default-naistest
  valkey:
    - access: read
      instance: naistest1
    - access: write
      instance: naistest2
---
apiVersion: aiven.io/v1alpha1
kind: Valkey
metadata:
  annotations: {}
  labels:
    aiven: enabled
  name: valkey-default-naistest1
  namespace: default
spec:
  plan: startup-4
  project: dev-project
  tags:
    app: aiven-demo
---
apiVersion: aiven.io/v1alpha1
kind: Valkey
metadata:
  annotations: {}
  labels:
    aiven: enabled
  name: valkey-default-naistest2
  namespace: default
spec:
  plan: startup-4
  project: dev-project
  tags:
    app: aiven-demo
